# Dockerfile for MiniFy Docs
# Designed to work when build context is the monorepo root
# Build: docker build -f apps/docs/dockerfile -t minify-docs .

FROM node:25-alpine AS builder

WORKDIR /app

# Copy only docs package.json from monorepo
COPY apps/docs/package.json ./

# Install dependencies using npm
RUN npm install

# Copy docs source files
COPY apps/docs/src ./src
COPY apps/docs/astro.config.mjs ./
COPY apps/docs/tsconfig.json ./
COPY apps/docs/nginx.conf ./

# Build the docs
RUN npm run build

# Production image with nginx
FROM nginx:alpine AS runner

# Copy built assets from builder
COPY --from=builder /app/dist /usr/share/nginx/html

# Copy nginx config from builder
COPY --from=builder /app/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 3002

CMD ["nginx", "-g", "daemon off;"]
